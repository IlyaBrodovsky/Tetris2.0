(()=>{"use strict";var e={314:(e,t,i)=>{i.d(t,{Z:()=>l});var s=i(645),n=i.n(s)()((function(e){return e[1]}));n.push([e.id,"body {\n\tmargin: 0;\n\tbackground-color: #000;\n}\n\n#root {\n\tpadding: 3rem;\n\ttext-align: center;\n}\n\n#root h1 {\n\tfont-family: 'Press Start 2P', Consolas, monospace;\n\tcolor: #fff;\n}\n\n#root canvas {\n\tdisplay: block;\n\tmargin: 0 auto;\n}\n",""]);const l=n},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=e(t);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(s)for(var l=0;l<this.length;l++){var r=this[l][0];null!=r&&(n[r]=!0)}for(var h=0;h<e.length;h++){var o=[].concat(e[h]);s&&n[o[0]]||(i&&(o[2]?o[2]="".concat(i," and ").concat(o[2]):o[2]=i),t.push(o))}},t}},379:(e,t,i)=>{var s,n=function(){var e={};return function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}e[t]=i}return e[t]}}(),l=[];function r(e){for(var t=-1,i=0;i<l.length;i++)if(l[i].identifier===e){t=i;break}return t}function h(e,t){for(var i={},s=[],n=0;n<e.length;n++){var h=e[n],o=t.base?h[0]+t.base:h[0],a=i[o]||0,c="".concat(o," ").concat(a);i[o]=a+1;var d=r(c),f={css:h[1],media:h[2],sourceMap:h[3]};-1!==d?(l[d].references++,l[d].updater(f)):l.push({identifier:c,updater:v(f,t),references:1}),s.push(c)}return s}function o(e){var t=document.createElement("style"),s=e.attributes||{};if(void 0===s.nonce){var l=i.nc;l&&(s.nonce=l)}if(Object.keys(s).forEach((function(e){t.setAttribute(e,s[e])})),"function"==typeof e.insert)e.insert(t);else{var r=n(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var a,c=(a=[],function(e,t){return a[e]=t,a.filter(Boolean).join("\n")});function d(e,t,i,s){var n=i?"":s.media?"@media ".concat(s.media," {").concat(s.css,"}"):s.css;if(e.styleSheet)e.styleSheet.cssText=c(t,n);else{var l=document.createTextNode(n),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(l,r[t]):e.appendChild(l)}}function f(e,t,i){var s=i.css,n=i.media,l=i.sourceMap;if(n?e.setAttribute("media",n):e.removeAttribute("media"),l&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(l))))," */")),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}var p=null,u=0;function v(e,t){var i,s,n;if(t.singleton){var l=u++;i=p||(p=o(t)),s=d.bind(null,i,l,!1),n=d.bind(null,i,l,!0)}else i=o(t),s=f.bind(null,i,t),n=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else n()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===s&&(s=Boolean(window&&document&&document.all&&!window.atob)),s));var i=h(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var s=0;s<i.length;s++){var n=r(i[s]);l[n].references--}for(var o=h(e,t),a=0;a<i.length;a++){var c=r(i[a]);0===l[c].references&&(l[c].updater(),l.splice(c,1))}i=o}}}}},t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={id:s,exports:{}};return e[s](n,n.exports,i),n.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{static points(){return{1:40,2:100,3:300,4:1200}}constructor(){this.reset()}get level(){return Math.floor(.1*this.lines)}getState(){const e=this.createPlayfield(),{y:t,x:i,blocks:s}=this.activePiece;for(let t=0;t<this.playfield.length;t++){e[t]=[];for(let i=0;i<this.playfield[t].length;i++)e[t][i]=this.playfield[t][i]}for(let n=0;n<s.length;n++)for(let l=0;l<s[n].length;l++)s[n][l]&&(e[t+n][i+l]=s[n][l]);return{score:this.score,level:this.level,lines:this.lines,nextPiece:this.nextPiece,playfield:e,isGameOver:this.topOut}}reset(){this.score=0,this.lines=0,this.topOut=!1,this.playfield=this.createPlayfield(),this.activePiece=this.createPiece(),this.nextPiece=this.createPiece()}createPlayfield(){const e=[];for(let t=0;t<20;t++){e[t]=[];for(let i=0;i<10;i++)e[t][i]=0}return e}createPiece(){const e={};switch("IJLOSTZ"[Math.floor(7*Math.random())]){case"I":e.blocks=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];break;case"J":e.blocks=[[0,0,0],[2,2,2],[0,0,2]];break;case"L":e.blocks=[[0,0,0],[3,3,3],[3,0,0]];break;case"O":e.blocks=[[0,0,0,0],[0,4,4,0],[0,4,4,0],[0,0,0,0]];break;case"S":e.blocks=[[0,0,0],[0,5,5],[5,5,0]];break;case"T":e.blocks=[[0,0,0],[6,6,6],[0,6,0]];break;case"Z":e.blocks=[[0,0,0],[7,7,0],[0,7,7]];break;default:throw new Error("неизвестный тип фигуры ")}return e.x=Math.floor((10-e.blocks[0].length)/2),e.y=-1,e}movePieceLeft(){this.activePiece.x-=1,this.hasCollision()&&(this.activePiece.x+=1)}movePieceRight(){this.activePiece.x+=1,this.hasCollision()&&(this.activePiece.x-=1)}movePieceDown(){if(!this.topOut){if(this.activePiece.y+=1,this.hasCollision()){this.activePiece.y-=1,this.lockPiece();const e=this.clearLines();this.updateScore(e),this.updatePieces()}this.hasCollision()&&(this.topOut=!0)}}rotatePiece(){this.rotateBlocks(),this.hasCollision()&&this.rotateBlocks(!1)}rotateBlocks(e=!0){const t=this.activePiece.blocks,i=t.length,s=Math.floor(i/2),n=i-1;for(let i=0;i<s;i++)for(let s=i;s<n-i;s++){const l=t[i][s];e?(t[i][s]=t[n-s][i],t[n-s][i]=t[n-i][n-s],t[n-i][n-s]=t[s][n-i],t[s][n-i]=l):(t[i][s]=t[s][n-i],t[s][n-i]=t[n-i][n-s],t[n-i][n-s]=t[n-s][i],t[n-s][i]=l)}}hasCollision(){const{y:e,x:t,blocks:i}=this.activePiece;for(let s=0;s<i.length;s++)for(let n=0;n<i[s].length;n++)if(i[s][n]&&(void 0===this.playfield[e+s]||void 0===this.playfield[e+s][t+n]||this.playfield[e+s][t+n]))return!0;return!1}lockPiece(){const{y:e,x:t,blocks:i}=this.activePiece;for(let s=0;s<i.length;s++)for(let n=0;n<i[s].length;n++)i[s][n]&&(this.playfield[e+s][t+n]=i[s][n])}clearLines(){let e=[];for(let t=19;t>=0;t--){let i=0;for(let e=0;e<10;e++)this.playfield[t][e]&&(i+=1);if(0===i)break;i<10||10===i&&e.unshift(t)}for(let t of e)this.playfield.splice(t,1),this.playfield.unshift(new Array(10).fill(0));return e.length}updateScore(t){t>0&&(this.score+=e.points()[t]*(this.level+1),this.lines+=t)}updatePieces(){this.activePiece=this.nextPiece,this.nextPiece=this.createPiece()}}class t{static colors(){return{1:"cyan",2:"blue",3:"orange",4:"yellow",5:"green",6:"purple",7:"red"}}constructor(e,t,i,s,n){this.element=e,this.width=t,this.height=i,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.playfieldBorderWidth=4,this.playfieldX=this.playfieldBorderWidth,this.playfieldY=this.playfieldBorderWidth,this.playfieldWidth=2*this.width/3,this.playfieldHigth=this.height,this.playfieldInnerWidth=this.playfieldWidth-2*this.playfieldBorderWidth,this.playfieldInnerHigth=this.playfieldHigth-2*this.playfieldBorderWidth,this.blockWidth=this.playfieldInnerWidth/n,this.blockHigth=this.playfieldInnerHigth/s,this.panelX=this.playfieldWidth+10,this.panelY=0,this.panelWidth=this.width/3,this.panelHeigth=this.hight,this.element.appendChild(this.canvas)}renderMainScreen(e){this.clearScreen(),this.renderPlayfield(e),this.renderPanel(e)}renderStartScreen(){this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Start",this.width/2,this.height/2)}renderPauseScreen(){this.context.fillStyle="rgba(0, 0, 0, 0.75)",this.context.fillRect(0,0,this.width,this.height),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("Press ENTER to Resume",this.width/2,this.height/2)}renderEndScreen({score:e}){this.clearScreen(),this.context.fillStyle="white",this.context.font='18px "Press Start 2P"',this.context.textAlign="center",this.context.textBaseline="middle",this.context.fillText("GAME OVER",this.width/2,this.height/2-48),this.context.fillText("SCORE "+e,this.width/2,this.height/2),this.context.fillText("Press ENTER to Restart",this.width/2,this.height/2+48)}clearScreen(){this.context.clearRect(0,0,this.width,this.height)}renderPlayfield({playfield:e}){for(let i=0;i<e.length;i++)for(let s=0;s<e[i].length;s++){const n=e[i][s];n&&this.renderBlock(this.playfieldX+s*this.blockWidth,this.playfieldY+i*this.blockHigth,this.blockWidth,this.blockHigth,t.colors()[n])}this.context.strokeStyle="white",this.context.lineWidth=this.playfieldBorderWidth,this.context.strokeRect(0,0,this.playfieldWidth,this.playfieldHigth)}renderPanel({level:e,score:i,lines:s,nextPiece:n}){this.context.textAlign="start",this.context.textBaseline="top",this.context.fillStyle="white",this.context.font='14px "Press Start 2P" ',this.context.fillText("Score: "+i,this.panelX,this.panelY+0),this.context.fillText("Lines: "+s,this.panelX,this.panelY+24),this.context.fillText("Level: "+e,this.panelX,this.panelY+48),this.context.fillText("Next",this.panelX,this.panelY+96);for(let e=0;e<n.blocks.length;e++)for(let i=0;i<n.blocks[e].length;i++){const s=n.blocks[e][i];s&&this.renderBlock(this.panelX+i*this.blockWidth*.5,this.panelY+100+e*this.blockHigth*.5,.5*this.blockWidth,.5*this.blockHigth,t.colors()[s])}}renderBlock(e,t,i,s,n){this.context.fillStyle=n,this.context.strokeStyle="black",this.context.lineWidth=2,this.context.fillRect(e,t,i,s,n),this.context.strokeRect(e,t,i,s,n)}}var s=i(379),n=i.n(s),l=i(314);n()(l.Z,{insert:"head",singleton:!1}),l.Z.locals;const r=document.querySelector("#root"),h=new e,o=new t(r,480,640,20,10),a=new class{constructor(e,t){this.game=e,this.view=t,this.intervalId=null,this.isPlaying=!1,document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this)),this.view.renderStartScreen()}update(){this.game.movePieceDown(),this.updateView()}play(){this.isPlaying=!0,this.startTimer(),this.updateView()}pause(){this.isPlaying=!1,this.stopTimer(),this.updateView()}reset(){this.game.reset(),this.play()}updateView(){const e=this.game.getState();e.isGameOver?this.view.renderEndScreen(e):this.isPlaying?this.view.renderMainScreen(e):this.view.renderPauseScreen()}startTimer(){const e=1e3-100*this.game.getState().level;this.intervalId||(this.intervalId=setInterval((()=>{this.update()}),e>0?e:100))}stopTimer(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}handleKeyDown(e){const t=this.game.getState();switch(e.keyCode){case 13:t.isGameOver?this.reset():this.isPlaying?this.pause():this.play();break;case 37:this.game.movePieceLeft(),this.updateView();break;case 39:this.game.movePieceRight(),this.updateView();break;case 40:this.stopTimer(),this.game.movePieceDown(),this.updateView();break;case 38:this.game.rotatePiece(),this.updateView()}}handleKeyUp(e){switch(e.keyCode){case 40:this.startTimer()}}}(h,o);window.game=h,window.view=o,window.controller=a})()})();